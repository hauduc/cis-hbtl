"0","# Create function to save pheatmap"
"0","save_pheatmap_png <- function(x, filename, units = ""in"", width = 10, height = 10) {"
"0","   stopifnot(!missing(x))"
"0","   stopifnot(!missing(filename))"
"0","   png(filename, units = units, width = width, height = height, res = 300)"
"0","   grid::grid.newpage()"
"0","   grid::grid.draw(x$gtable)"
"0","   dev.off()"
"0","}"
"0",""
"0","# Create function that generates pheatmap"
"0","make_pheatmap_on_top_rois_populated_mean_treat_pileup <- function(mark, rois_table_populated, feature_name, description) {"
"0","  # Add in metadata"
"0","  # This will vary depending on exact mark assessed"
"0","  # H3K9me3 is missing one BC dataset but the rest of the marks aren't"
"0","  if (mark == ""H3K9me3"") {"
"0","    current_metadata_frame <- "
"0","      data.frame(row.names = list_peak[[mark]] %>% names(),"
"0","                 Cell_type = c(rep(""BC"", 7), "
"0","                               rep(""LP"", 8), "
"0","                               rep(""LC"", 8), "
"0","                               rep(""SC"", 8), "
"0","                               rep(""Cell line"", 3)) %>% factor(c(""BC"", ""LP"", ""LC"", ""SC"", ""Cell line"")),"
"0","                 stringsAsFactors = FALSE)"
"0","    } else {"
"0","    current_metadata_frame <- "
"0","      data.frame(row.names = list_peak[[mark]] %>% names(),"
"0","                 Cell_type = c(rep(""BC"", 8), "
"0","                               rep(""LP"", 8), "
"0","                               rep(""LC"", 8), "
"0","                               rep(""SC"", 8), "
"0","                               rep(""Cell line"", 3)) %>% factor(c(""BC"", ""LP"", ""LC"", ""SC"", ""Cell line"")),"
"0","                 stringsAsFactors = FALSE)"
"0","    }"
"0","  "
"0","  # Plot bigWig-filled ROI GRanges in pheatmap as a matrix with generated metadata"
"0","  rois_table_populated[[mark]] %>% "
"0","    mcols() %>% "
"0","    as.data.frame() %>% "
"0","    select(-partition, -samples_mean, -samples_RSD) %>% "
"0","    column_to_rownames(""tile_id"") %>% "
"0","    as.matrix() %>% "
"0","    pheatmap(annotation_col = current_metadata_frame,"
"0","             clustering_method = ""ward.D2"","
"0","             clustering_distance_cols = ""spearman"", "
"0","             color = colorRampPalette(c(""white"", ""blue""))(100),"
"0","             main = str_c(mark, description, sep = "" ""), "
"0","             show_colnames = TRUE,"
"0","             show_rownames = FALSE,"
"0","             fontsize = 12,"
"0","             width = 10,"
"0","             height = 10) %>%"
"0","    save_pheatmap_png(str_c(""plots/pheatmap_"", mark, ""_spearman_rois_treatment_pileup_top_varying_"", feature_name, "".png""))"
"0","} "
