"0","# Source Jonathan code adjustments"
"0","source(""/projects/epigenomics3/epigenomics3_results/users/jsteif/scripts/functions_to_source/spearman_pheatmapV2.R"") "
"0",""
"0","# Create function to save pheatmap"
"0","save_pheatmap_png <- function(x, filename, units = ""in"", width = 10, height = 10) {"
"0","   stopifnot(!missing(x))"
"0","   stopifnot(!missing(filename))"
"0","   png(filename, units = units, width = width, height = height, res = 300)"
"0","   grid::grid.newpage()"
"0","   grid::grid.draw(x$gtable)"
"0","   dev.off()"
"0","}"
"0",""
"0","# Create function that generates pheatmap"
"0","make_pheatmap_on_top_varying_promoters <- function(mark) {"
"0","  # Add in metadata"
"0","  current_metadata_frame <- "
"0","    data.frame(row.names = list_peak[[mark]] %>% names(),"
"0","               Cell_type = c(rep(""BC"", 8), rep(""LP"", 8), rep(""LC"", 8), rep(""SC"", 8), rep(""Cell line"", 3)) %>% factor(c(""BC"", ""LP"", ""LC"", ""SC"", ""Cell line"")),"
"0","               stringsAsFactors = FALSE)"
"0","  "
"0","  # Plot bigWig-filled ROI GRanges in pheatmap as a matrix with generated metadata"
"0","  rois_bw_filled_top_varying[[mark]] %>% "
"0","    mcols() %>% "
"0","    as.data.frame() %>% "
"0","    select(-partition, -samples_mean, -samples_RSD) %>% "
"0","    column_to_rownames(""tile_id"") %>% "
"0","    as.matrix() %>% "
"0","    pheatmap(annotation_col = current_metadata_frame,"
"0","             clustering_method = ""ward.D2"","
"0","             clustering_distance_cols = ""spearman"", "
"0","             color = colorRampPalette(c(""white"", ""blue""))(100),"
"0","             main = str_c(mark, ""Treatment Read Pileup Depth in 150bp Bins in Promoters"", sep = "" ""), "
"0","             show_colnames = TRUE,"
"0","             show_rownames = FALSE,"
"0","             fontsize = 12,"
"0","             width = 10,"
"0","             height = 10) %>%"
"0","    save_pheatmap_png(str_c(""plots/pheatmap_"", mark, ""_spearman_rois_promoters.png""))"
"0","} "
