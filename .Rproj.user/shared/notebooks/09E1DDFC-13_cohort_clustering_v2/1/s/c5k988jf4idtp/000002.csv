"0","# Create function to return correlation numeric for every sample pair combination"
"0","granges_roi_cor <- function(bw1_path, bw2_path, rois, blacklist_regions_gr = blacklist_encode, cor_method = c(""pearson"", ""kendall"", ""spearman"")) {"
"0","  "
"0","  # Read in bigWigs cleanly"
"0","  bw1 <- read_bigwig(bw1_path) %>% keepSeqlevels(const_canonical_chromosomes, pruning.mode = ""coarse"")"
"0","  bw2 <- read_bigwig(bw2_path) %>% keepSeqlevels(const_canonical_chromosomes, pruning.mode = ""coarse"")"
"0","  "
"0","  # Get valid roi ranges with or without blacklist"
"0","  if (is.null(blacklist_regions_gr)) {"
"0","    rois_clean <- rois %>% keepSeqlevels(const_canonical_chromosomes, pruning.mode = ""coarse"")"
"0","  } else {"
"0","    rois_clean <- rois %>% keepSeqlevels(const_canonical_chromosomes, pruning.mode = ""coarse"") %>% filter_by_non_overlaps(blacklist_regions_gr) # Remove blacklisted regions"
"0","  }"
"0","  "
"0","  # Take bigWig"
"0","  # Subset by valid peak ranges and break these subsets up into single basepair regions with the score annotated"
"0","  # Remove non-canonical chromosomes"
"0","  # Annotate with the unique tile ids that are x-basepairs wide"
"0","  # Convert to tibble to group by tile_id faster, then group and summarize mean of bigWig scores by tile_id that are x-basepairs wide"
"0","  bw1_roi_tiles_summarized <- "
"0","    bw1 %>% "
"0","    join_overlap_intersect(rois_clean %>% tile_ranges(width = 1)) %>% "
"0","    join_overlap_left(rois_clean) %>% "
"0","    plyranges::group_by(tile_id) %>% "
"0","    plyranges::summarize(mean_pileup_depth = mean(score))"
"0","  "
"0","  # Repeat above for bw2"
"0","  bw2_roi_tiles_summarized <- "
"0","    bw2 %>% "
"0","    join_overlap_intersect(rois_clean %>% tile_ranges(width = 1)) %>% "
"0","    join_overlap_left(rois_clean) %>% "
"0","    plyranges::group_by(tile_id) %>% "
"0","    plyranges::summarize(mean_pileup_depth = mean(score))"
"0","  "
"0","  # Clean up large files"
"0","  rm(bw1, bw2)"
"0","  "
"0","  # Return correlation of mean scores vector of x-basepair windows of two bigWigs"
"0","  cor(bw1_roi_tiles_summarized$mean_pileup_depth,"
"0","      bw2_roi_tiles_summarized$mean_pileup_depth,"
"0","      method = cor_method)"
"0","}"
