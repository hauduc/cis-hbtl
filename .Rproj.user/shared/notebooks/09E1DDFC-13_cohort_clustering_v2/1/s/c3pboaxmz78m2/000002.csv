"0","# Function to plot heatmap"
"0","make_matrix_heatmap <- function(cluster_matrix, mark_name, cluster_type) {"
"0","  # Create a distance matrix from long dataframe"
"0","  cluster_matrix %>% "
"0","    reshape2::melt(na.rm = TRUE) %>% "
"0","    ggplot(aes(Var2, Var1, fill = value)) +"
"0","    geom_tile(color = ""white"") +"
"0","    scale_fill_gradient2(low = ""white"", "
"0","                         high = ""red"", "
"0","                         limit = c(0, 1), "
"0","                         space = ""Lab"", "
"0","                         name = str_c(mark_name, "" Peak\n"", cluster_type, "" Correlations"")) +"
"0","    theme(axis.text.x = element_text(angle = 45, vjust = 1, "
"0","                                     size = 3, hjust = 1),"
"0","          axis.title.x = element_blank(),"
"0","          axis.title.y = element_blank(),"
"0","          panel.grid.major = element_blank(),"
"0","          panel.border = element_blank(),"
"0","          panel.background = element_blank(),"
"0","          axis.ticks = element_blank(),"
"0","          axis.text.y = element_text(size = 3),"
"0","          legend.justification = c(1, 0),"
"0","          legend.position = c(0.6, 0.7),"
"0","          legend.direction = ""horizontal"") +"
"0","    coord_fixed() + "
"0","    geom_text(aes(Var2, Var1, label = round(value, 2)), color = ""black"", size = 1) +"
"0","    guides(fill = guide_colorbar(barwidth = 7, "
"0","                                 barheight = 1,"
"0","                                 title.position = ""top"", "
"0","                                 title.hjust = 0.5))"
"0","  ggsave(str_c(""plots/heatmap_"", cluster_type, ""_individual_celltype_"", mark_name, ""_v2.png""))"
"0","}"
