"0","# Function to create Jaccard similarity matrices for any cell type"
"0","make_spearman_matrix_m1 <- function(mark) {"
"0","  # Create new combos for all possible individual-celltypes"
"0","  # Non-redundant pair combinations of all 2-SAMPLE combinations"
"0","  set_pair_combos <- combn(names(list_peak[[mark]]), 2) %>% t()"
"0","  "
"0","  # Initialize data frame"
"0","  cor_matrix <- data.frame()"
"0","  "
"0","  # Test every combination of individuals for jaccard and build distances into a labelled dataframe"
"0","  for (combo_row in 1:nrow(set_pair_combos)) {"
"0","    # Create a row with combo index and correlation value"
"0","    current_frame <- data.frame(sample1 = set_pair_combos[combo_row, 1],"
"0","                                sample2 = set_pair_combos[combo_row, 2],"
"0","                                correlation = granges_peak_cor_m1(list_treat_pileup_bw_wasp_files_v2[[mark]][[set_pair_combos[combo_row, 1]]],"
"0","                                                                  list_treat_pileup_bw_wasp_files_v2[[mark]][[set_pair_combos[combo_row, 2]]],"
"0","                                                                  list_peak[[mark]][[set_pair_combos[combo_row, 1]]],"
"0","                                                                  list_peak[[mark]][[set_pair_combos[combo_row, 2]]],"
"0","                                                                  cor_method = ""spearman""))"
"0","    # Add row to total matrix"
"0","    cor_matrix <- bind_rows(cor_matrix, current_frame)"
"0","    "
"0","    # Display progress"
"0","    message(str_c(current_frame[1,1], current_frame[1,2], current_frame[1,3], sep = "" ""))"
"0","    "
"0","  }"
"0","  "
"0","  # Add same-sample matches at the beginning"
"0","  # And pivot wider to full matrix format"
"0","  bind_rows(data.frame(sample1 = names(list_peak[[mark]]),"
"0","                       sample2 = names(list_peak[[mark]]),"
"0","                       correlation = 1),"
"0","            cor_matrix) %>% "
"0","    pivot_wider(names_from = sample2, values_from = correlation) %>% "
"0","    column_to_rownames(""sample1"") %>% "
"0","    as.matrix()"
"0","}"
